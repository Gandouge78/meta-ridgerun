From d165634984d5d600576701bf028194b92afe2c8b Mon Sep 17 00:00:00 2001
From: Richard Buchmann <richard.buchmann@arcure.net>
Date: Mon, 12 Apr 2021 12:54:21 +0200
Subject: [PATCH] gstd yocto compatibility

Signed-off-by: Richard Buchmann <richard.buchmann@arcure.net>
---
 autogen.sh                      | 8 +++++++-
 docs/reference/gstd/Makefile.am | 2 +-
 gstd/Makefile.am                | 3 +--
 libgstc/python/Makefile.am      | 4 ++--
 4 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/autogen.sh b/autogen.sh
index c9e8d0c..4e22e9e 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -21,7 +21,11 @@
 # ACLOCAL, AUTOPOINT and/or LIBTOOLIZE to the right versions, or leave them
 # unset and get the defaults
 
-gtkdocize || exit 1
+test -n "$srcdir" || srcdir=`dirname "$0"`
+test -n "$srcdir" || srcdir=.
+
+olddir=`pwd`
+cd "$srcdir"
 
 autoreconf --verbose --force --install || {
  echo 'autogen.sh failed';
@@ -38,3 +42,5 @@ fi
 echo
 echo "Now run './configure' with your system settings followed by 'make' to compile this module."
 echo
+
+cd "$olddir"
diff --git a/docs/reference/gstd/Makefile.am b/docs/reference/gstd/Makefile.am
index 62870da..b3ec44e 100644
--- a/docs/reference/gstd/Makefile.am
+++ b/docs/reference/gstd/Makefile.am
@@ -66,7 +66,7 @@ GTKDOC_LIBS=$(top_builddir)/gstd/libgstd-core.la
 
 
 # This includes the standard gtk-doc make rules, copied by gtkdocize.
-include $(top_builddir)/docs/gtk-doc.make
+# include $(top_builddir)/docs/gtk-doc.make
 
 # Comment this out if you want 'make check' to test you doc status
 # and run some sanity checks
diff --git a/gstd/Makefile.am b/gstd/Makefile.am
index 5a90e28..5fbee22 100644
--- a/gstd/Makefile.am
+++ b/gstd/Makefile.am
@@ -84,8 +84,7 @@ gstd_LDFLAGS = $(GST_LIBS)					\
 	       $(GIO_UNIX_LIBS)					\
 	       $(GJSON_LIBS)					\
 	       $(LIBD_LIBS)					\
-	       $(LIBSOUP_LIBS)					\
-	       -Wl,-rpath -Wl,$(libdir)
+	       $(LIBSOUP_LIBS)
 
 gstd_LDADD = libgstd-core.la
 
diff --git a/libgstc/python/Makefile.am b/libgstc/python/Makefile.am
index a30715a..3bc36d3 100644
--- a/libgstc/python/Makefile.am
+++ b/libgstc/python/Makefile.am
@@ -1,2 +1,2 @@
-install-am:
-	@sudo -H pip3 install .
+# install-am:
+# 	@sudo -H pip3 install .
